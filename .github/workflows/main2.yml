name: Container Watchdog

on:
  schedule:
    - cron: '*/5 * * * *'
  push:
    branches: [ main ]

jobs:
  monitor-and-restart:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run container watchdog
        shell: powershell
        run: |
          powershell -NoProfile -ExecutionPolicy Bypass -Command "
            try {
                $running = docker inspect -f '{{.State.Running}}' 478d06b51702 2>$null
                if ($running -eq 'true') {
                    Write-Output 'Container is running.'
                } else {
                    Write-Output 'Container is NOT running. Starting...'
                    docker start -ai 478d06b51702
                    Write-Output 'Container started successfully.'
                }
            } catch {
                Write-Output 'Container does not exist or Docker not found.'
                exit 1
            }
          "
