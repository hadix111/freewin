name: Deploy Node.js App
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    # این کار فقط روی Runner نصب‌شده روی کامپیوتر شما اجرا می‌شود
    runs-on: self-hosted

    steps:
      # مرحله 1: دریافت آخرین کد از مخزن
      - name: Checkout code
        uses: actions/checkout@v4

      # مرحله 2: نصب وابستگی‌های پروژه
      - name: Install Dependencies
        run: npm install

      # مرحله 3: توقف، راه‌اندازی و ذخیره برنامه با PM2
      - name: Start/Restart App with PM2
        run: |
          pm2 stop my-node-app || true
          pm2 start 'npm run start' --name my-node-app
          pm2 save
